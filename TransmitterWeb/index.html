<div><label>送信データステップ</label><input type="number" id="step" value="100"></div>
<div><label>タイマ精度(μs)</label><input type="number" id="precision" value="112"></div>
<div><label>誤差幅(steps)</label><input type="number" id="width" value="10"></div>

<div><label>送信データ</label><input type="number" id="data" value="2300" step="100"></div>

<div><button id="toggle">送出</button> 周波数: <span id="frequency">0</span> Hz</div>

<script>
    let step = 100;
    let precision = 112;
    let width = 10;
    let data = 2300;
    let frequency = 0;
    
    const audioContext = new AudioContext();
    audioContext.suspend();
    const squareOscillator = audioContext.createOscillator();
    squareOscillator.type = "square";
    squareOscillator.connect(audioContext.destination);
    squareOscillator.start();
    calculateFrequency();

    document.getElementById("step").addEventListener("change", e => {
        step = e.target.value;
        document.getElementById("data").step = step;
        calculateFrequency();
    });
    document.getElementById("precision").addEventListener("change", e => {
        precision = e.target.value;
        calculateFrequency();
    });
    document.getElementById("width").addEventListener("change", e => {
        width = e.target.value;
        calculateFrequency();
    });
    document.getElementById("data").addEventListener("change", e => {
        data = e.target.value;
        calculateFrequency();
    });

    function calculateFrequency() {
        frequency = 1000000 / (precision * width * Math.round(data / step));
        document.getElementById("frequency").textContent = frequency;
        squareOscillator?.frequency.setValueAtTime(frequency, audioContext.currentTime);
    }

    document.getElementById("toggle").addEventListener("click", e => {
        if (audioContext.state === "running") {
            audioContext.suspend();
            e.target.textContent = "送出";
        } else {
            audioContext.resume();
            e.target.textContent = "停止";
        }
    });
</script>